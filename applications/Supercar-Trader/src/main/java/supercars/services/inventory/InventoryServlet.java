/**
 * 
 */
package supercars.services.inventory;

import java.io.IOException;
import java.util.Collection;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import supercars.Manufacturer;
import supercars.dataloader.ManufacturerDataLoader;
import supercars.utils.json.JSONArray;

/**
 * @author james
 *
 */
public class InventoryServlet extends HttpServlet {

	/**
	 * 
	 */
	private static final long serialVersionUID = -918705794873331672L;
	private static Log log = LogFactory.getLog(InventoryServlet.class);
	

	/**
	 * 
	 */
	public InventoryServlet() {
		
	}
	
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    	
		try {
			
			log.info("!!!!!!!!!!!!!!!! Inventory Service Recieved Request URI: " + request.getRequestURI());
			
			String reqUri = request.getRequestURI();
	    	
	    	if (reqUri.equals("/inventory/manufacturers")) {
	    		
					
	    		ManufacturerDataLoader mdl = new ManufacturerDataLoader();
	    		Collection<Manufacturer> result = mdl.getManufacturers();
	    		JSONArray jsonArray = new JSONArray(result);
	    		
	    		String json = jsonArray.toString(4);
					
			    log.info("!!!!!!!!!!!!!!!! JSON Payload generated by Inventory Service " + request.getRequestURI());
			    log.info(json);
					
			    response.setContentType("application/json");
			    response.setStatus(HttpServletResponse.SC_OK);
			    response.getWriter().println(json);

	    	} else {
	    		log.info("!!!!!!!!!!!!!!!! Inventory Service URI HAD NO MATCH: " + request.getRequestURI());
	    		
	            response.setContentType("application/json");
	            response.setStatus(HttpServletResponse.SC_OK);
	            response.getWriter().println("{ \"status\": \"ok\"}");	    		
	    	}
			
		} catch (Throwable ex) {
			log.info("########################## Inventory Service Failure ##########################");
			log.error("########################## " + ex.getMessage() + " ##########################", ex);
			ex.printStackTrace();
				
		}
		
    	
    }
    
    
}
